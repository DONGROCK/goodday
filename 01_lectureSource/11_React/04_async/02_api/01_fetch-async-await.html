<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script crossorigin src='https://unpkg.com/react@18/umd/react.development.js'></script>
    <script crossorigin src='https://unpkg.com/react-dom@18/umd/react-dom.development.js'></script>
    <script src='https://unpkg.com/@babel/standalone/babel.min.js'></script>

</head>

<body>
    <div id='root'></div>

    <script type='text/babel'>
        /*
            자바스크립트를 사용하면 필요할 때 서버에 네트워크 요청을 보내고 새로운 정보를 받아올 수 있다.
            Ajax를 이용해 페이지 새로고침(비동기식) 서버에서 데이터를 가져올 수 있다.
            Ajax 외에도 서버에 네트워크 요청을 보내고 받아올 수 있는 방법 중 fetch api를 이용할 수 있다.
            fetch는 구식 브라우저에서는 지원하지 않지만 대부분의 모던 브라우저가 지원하고 있따.

            기본 사용법
            let promis = fetch(url, [option])

            url: 접근하고자 하는 url http....
            options: 선택 매개변수로 http method나 headers, body내용을 객체로 지정할 수 있따.

            options에 아무값도 넣지 않으면 기본 GET메소드(8가지 http method 중)로 요청을 하게 된다.
            
            !!!fetch를 호출하면 브라우저는 네트워크 요청을 보내고 promise를 반환한다.!!! then사용가능해짐
            반환받은 promise가 내장 클래스 Response 인스턴스와 함께 이행 상태가 된다.
            아직 본문(body)이 도착하기 전이지만 개발자는 응답 헤더를 보고 요청이 성공적으로 처리되었는지 확인할 수 있다.
            네트워크 문제로 존재하지 않는 경로 혹은 http 요청을 보낼 수 없는 상태에서는 promise는 거부 상태가 된다.
            
            fake Api 
            https://jsonplaceholder.typicode.com/
            */
            async function callAPI(){

                console.log(fetch('https://jsonplaceholder.typicode.com/users'));
                
                const promise = fetch ('https://jsonplaceholder.typicode.com/users') //promise객체

                console.log(promise['[[PromiseResult]]']); //PromiseResult라는 프로미스안의 프로퍼티에는
                                                            //직접접근이 불가능하다.
                                                            
                    // /*1. promise의 then메소드 활용*/
                    // promise.then((response) =>{
                    //     console.log(response);
                        
                    // })
                    //2. async await를 활용해서 결과 객체 꺼내기
                    const response = await promise
                    console.log(response);

                    console.log(`응답상태: ${response.status}`)
                    console.log('응답 헤더');
                    console.log(response.headers);

                    for(let [key, value] of response.headers){
                        console.log(`${key}: ${value}`);
                    }
                    console.log(`본문내용사용여부: ${response.bodyUsed}`);

                    // const responseText = await response.text() //response.text json 등등 형식
                    // console.log(responseText);

                    const json = await response.json()
                    console.log(json);
                    console.log(json[0]);
                    console.log(json[0].name);
                    console.log(json[0].email);
                    
                    console.log(`본문내용사용여부: ${response.bodyUsed}`);
                    
                    // json = await response.json() //응답을 1회 받고 난 후 body내용을 확인 후에는 더이상 응답 body에 접근 할 수 없다.
                    // console.log(json);

                    console.log('end');
            }
            function App(){
                const onClickHandler = () =>{
                    callAPI()
                }

                return<button onClick={onClickHandler}>API요청</button>
            }
            ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
            callAPI()

    </script>
</body>

</html>